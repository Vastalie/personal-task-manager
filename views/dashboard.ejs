<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Styles omitted for brevity */
    </style>
</head>
<body>
    <h1 style="text-align: center; padding: 20px; color: #80d0c7;">Dashboard</h1>
    <header style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
        <h1 style="color: #80d0c7;">Dashboard</h1>
        <button id="theme-toggle" style="padding: 10px; cursor: pointer;">Switch Theme</button>
    </header>

    <div class="dashboard" 
         data-total-tasks="<%= metrics.total_tasks %>" 
         data-completed-tasks="<%= metrics.completed_tasks %>" 
         data-pending-tasks="<%= metrics.pending_tasks %>" 
         data-overdue-tasks="<%= metrics.overdue_tasks %>" 
         data-monthly-data='<%- JSON.stringify(monthlyData) %>'>
        
        <!-- Tasks Overview -->
        <div class="card">
            <h2>Tasks Overview</h2>
            <div class="metric">Total: <%= metrics.total_tasks %></div>

            <div class="bar-container">
                <div class="bar-label">Completed</div>
                <div class="bar">
                    <div id="completed-bar" class="bar-fill"></div>
                </div>
            </div>
            <div class="bar-container">
                <div class="bar-label">Pending</div>
                <div class="bar">
                    <div id="pending-bar" class="bar-fill"></div>
                </div>
            </div>
            <div class="bar-container">
                <div class="bar-label">Overdue</div>
                <div class="bar">
                    <div id="overdue-bar" class="bar-fill"></div>
                </div>
            </div>
        </div>

        <!-- Monthly Task Chart -->
        <div class="card">
            <h2>Monthly Tasks</h2>
            <div class="chart-container">
                <canvas id="monthlyTasksChart"></canvas>
            </div>
        </div>

        <!-- Task Status Breakdown -->
        <div class="card">
            <h2>Task Status Breakdown</h2>
            <div class="chart-container">
                <canvas id="taskStatusChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const dashboardElement = document.querySelector('.dashboard');
            const totalTasks = parseInt(dashboardElement.getAttribute('data-total-tasks'), 10) || 0;
            const completedTasks = parseInt(dashboardElement.getAttribute('data-completed-tasks'), 10) || 0;
            const pendingTasks = parseInt(dashboardElement.getAttribute('data-pending-tasks'), 10) || 0;
            const overdueTasks = parseInt(dashboardElement.getAttribute('data-overdue-tasks'), 10) || 0;
            const monthlyData = JSON.parse(dashboardElement.getAttribute('data-monthly-data')) || Array(12).fill(0);

            // Set progress bars
            document.getElementById('completed-bar').style.width = totalTasks ? (completedTasks / totalTasks) * 100 + '%' : '0%';
            document.getElementById('pending-bar').style.width = totalTasks ? (pendingTasks / totalTasks) * 100 + '%' : '0%';
            document.getElementById('overdue-bar').style.width = totalTasks ? (overdueTasks / totalTasks) * 100 + '%' : '0%';

            // Monthly Chart
            const monthlyCtx = document.getElementById('monthlyTasksChart').getContext('2d');
            new Chart(monthlyCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Tasks Completed Each Month',
                        data: monthlyData,
                        backgroundColor: '#80d0c7',
                        borderRadius: 5,
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true, ticks: { color: '#ffffff' } },
                        x: { ticks: { color: '#ffffff' } }
                    }
                }
            });

            // Task Status Pie Chart
            const taskStatusCtx = document.getElementById('taskStatusChart').getContext('2d');
            new Chart(taskStatusCtx, {
                type: 'pie',
                data: {
                    labels: ['Completed', 'Pending', 'Overdue'],
                    datasets: [{
                        data: [completedTasks, pendingTasks, overdueTasks],
                        backgroundColor: ['#80d0c7', '#ffcc00', '#ff6347']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#ffffff' } } }
                }
            });
        });
    </script>
</body>
</html>
